C WAVGEN.FOR- PROGRAM TO GENERATE PACKED TEST DATA FOR POWSP, ETC

C PRODUCES 5 2-CHANNEL RECORD-SETS, EACH RECORD WITH 256 PTS.

C RECORDS OF EACH SET ARE SINE WAVES W/ 90 DEGREE PHASE SHIFT.

C SETS CONTAIN SINE WAVES OF 2,4,6,8, &10HZ, RESPECTIVELY.

      PROGRAM WAVGEN

      INCLUDE 'MAX.INC'

	CHARACTER*4 LABS(30),TXT(108)

	CHARACTER*1 ANS,YES,YES0

	DIMENSION ILABS(30),ID(8),BUF(IOMAX)

	COMMON/FLDESO/ NGO,NAO,NCO,NDO,NFO,NPO,NRO,ISO,IBUF(IOMAX)

	EQUIVALENCE (IBUF(1),TXT(1)),(IBUF(109),ILABS(1)),(LABS,ILABS)

	EQUIVALENCE (ID(1),NGO),(IBUF(1),BUF(1))

	DATA ID /3,0,2,256,2,131,0,128/

	DATA LABS/'CHAN',' NUM','BER ',3*'    ',

     1          'RAND','OM N','UMBE','R   ',2*'    ',

     2          'FREQ','UENC','Y   ',3*'    ',

     3          'SINE',4*'    ',' 1,1',

     4          'COSI','NE  ',3*'    ',' 1,2'/

	DATA TXT/'POWE','R SP','ECTR','UM T','EST ','DATA',

     1 12*'    ','2,4,','6,8,','&10 ','HZ S','INE ','WAVE','S IN',

     2 ' SUC','CESS','IVE ','RECO','RDS ',78*'    '/

      DATA YES,YES0/'Y','y'/

      WRITE(*,100)

100   FORMAT('NUMBER OF POINTS>'\)

      READ(*,*) NDO

      WRITE(*,101)

101   FORMAT('SAMPLING RATE(HZ)>'\)

      READ(*,*) ISO

      WRITE(*,200)

200   FORMAT('FORMAT(1=>INTEGER, 2=>PACKED, 3=>REAL)>'\)

      READ(*,*) NFO

      IF(NFO.EQ.2) GOTO 300

      IF(NFO.GT.3 .OR. NFO.LE.0) NFO=3

      NPO=NDO + NGO

      GO TO 301

300   NPO=NDO/2 + NGO

301   WRITE(*,201)

201   FORMAT('SCALE='\)

      READ(*,*) SCALE

      WRITE(*,202)

202   FORMAT('MODULATED? '\)

      READ(*,*) ANS

      IF(ANS.NE.YES .AND. ANS.NE.YES0) GO TO 303

      WRITE(*,203)

203   FORMAT('FREQUENCY OF CARRIER(HZ)>'\)

      READ(*,*)FREQ

      GO TO 302

303   FREQ=0.

302   CALL PUTOPN

10    CALL PUTSTD(ID)

	CALL PUTSTD(ILABS)

	F1=6.283185/REAL(ISO)

	F2=F1*FREQ

	DO 35 I=2,10,2

	IBUF(2)=INT4(256.*RAND(0))

	IBUF(3)=I

	F3=F1*REAL(I)

	DO 35 J=1,2

	IBUF(1)=J

	DO 30 K=NGO+1,NDO+2

	ARG=REAL(K-NGO-1)*F3

	ARG1=REAL(K-NGO-1)*F2

	IF(J-1)20,20,19

19    IF(FREQ.NE.0.) GO TO 119

      X=COS(ARG)*SCALE

      GO TO 31

119   X=COS(ARG1)*SCALE*(1.-0.7*COS(ARG))

	GO TO 31

20    IF(FREQ.NE.0.) GO TO 120

      X=SIN(ARG)*SCALE

      GO TO 31

120   X=COS(ARG1)*SCALE*(1.-0.7*SIN(ARG))

31    IF(NFO.EQ.3) GO TO 32

      IBUF(K)=INT4(X+0.5)

      GO TO 30

32    BUF(K)=X

30    CONTINUE

C PACK THIS RECORD'S DATA

      IF(NFO.NE.2) GO TO 35

	K=NGO+1

	DO 33 L=NGO+1,NDO+NGO,2

	CALL PACK(IBUF(L),IBUF(L+1),IBUF(K)) !ASSUMES THAT NDO IS EVEN

33    K=K+1

35    CALL PUTSTD(IBUF)

	CALL PUTEND

      STOP

	END PROGRAM WAVGEN

