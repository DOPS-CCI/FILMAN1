C PTPASS.FOR- PASSES DATA POINTS WITHOUT FORMAT CHANGE, TO SAVE SPACE.

C ALSO ALLOWS MOVEMENT OF GROUP VARS TO DATA VARS, PLUS INSERTION OF A

C NEW DATA VAR- TRIAL OR RECORD-SET NUMBER. BYPASSES XVAL, SO RUN WITH

C POINT LIST=1-ND. NEW VARS APPENDED TO OLD, FIRST GROUPS THEN TRIAL #.

	SUBROUTINE PTPASS

      INCLUDE 'MAX.INC'

	COMMON IFLAG1,IFLAG2,IFLAG3,KNT,ISZ,ICHAN(ICHMAX)

	COMMON /FLDES/NG,NA,NC,ND,NF,NP,NR,IS,IBUF(IOMAX)

	COMMON /FLDESO/NGO,NAO,NCO,NDO,NFO,NPO,NRO,ISO,IBUFO(IOMAX)

	CHARACTER*1 ANS,IYES,IYES0,ILP,IRP

	DIMENSION LABS(6,20),ITMP(21)

	INTEGER, SAVE :: ITF,IGRP(20),NGRP,ICH,NS,NSO,NWORD,NNEW

	EQUIVALENCE (LABS(1,1),IBUF(1)),(IX,X)

	DATA IYES,IYES0,ILP,IRP/'Y','y','(',')'/
      COMMON /CPN/ CURPROCNAME
      CHARACTER*10 CURPROCNAME

	IF(IFLAG1)10,30,50

10      NFO=NF
      CURPROCNAME='PTPASS'

	ITF=0

      NS=1
      CALL DoPTPASSDialog(ITF,IGRP,IGN,NS)

!	WRITE(*,200)
!
!200     FORMAT('$INSERT TRIAL #? >',\)
!
!	READ(*,100)ANS
!
!100     FORMAT(A)
!
!	IF(ANS.EQ.IYES .OR. ANS.EQ.IYES0)ITF=1

	IF(NG-1)15,15,11

11    CONTINUE  
!      WRITE(*,201)(J,(LABS(I,J),I=1,6),J=2,NG)
!
!201     FORMAT(' GROUP ',I2,' ID=',6A4)
!
!	WRITE(*,202)
!
!202     FORMAT('$WANT TO MOVE ANY GROUP VARS? >',\)
!
!	READ(*,100)ANS
!
!	IF(ANS.NE.IYES .OR. ANS.EQ.IYES0)GOTO 15

12    CONTINUE  
!      WRITE(*,203)(ILP,IRP,I=2,NG)
!
!203     FORMAT(' WHICH ONES?'/1H ,20(A,2XA),T1\)
!
!	READ(*,102)(IGRP(I),I=1,NG-1)
!
!102     FORMAT(1XI2,19(2XI2))

	NGRP=0

	DO 13 I=1,NG-1

	IF(IGRP(I))15,15,13

13      NGRP=NGRP+1

15    CONTINUE  
!      WRITE(*,204)
!
!204     FORMAT('$PASS ALL POINTS? >',\)
!
!	READ(*,100)ANS
!
!	IF (ANS.NE.IYES .AND. ANS.NE.IYES0)GOTO 17

16    CONTINUE  
      NS=1

	GO TO 20

!17      WRITE(*,205)
!
!205     FORMAT('$FIRST POINT? NUMBER OF POINTS? >'\)
!
!	READ(*,*)NS,NDO

20      NSO=NGO+NAO+1

	IF(NF-2)22,21,22

21      NS=NG+NA+(NS-1)/2+1

	NWORD=NDO/2

	GO TO 23

22      NS=NG+NA+NS

	NWORD=NDO

23      NNEW=ITF+NGRP

	NDO=NDO+NNEW

	IF(NF-2)24,235,25

235     IF(MOD(NNEW,2).EQ.1)NDO=NDO+1

24      ISZ=NDO/NF

	GO TO 26

25      ISZ=NDO

26      J=6*NGO+109

	DO 28 I=1,NCO

	L=J+5

	K=6*(NG+ICHAN(I))-5

	DO 27 I1=J,L

	IBUFO(I1)=IBUF(K)

27      K=K+1

28      J=J+6

	ICH=0

	RETURN

C RUNNING SECTION

30      J=NS

	K=NSO

	DO 31 I=1,NWORD

	IBUFO(K)=IBUF(J)

	J=J+1

31      K=K+1

	IF(NNEW)49,49,32

32      IF(ICH)321,321,47

321     N=1

	IF(NGRP)35,35,33

33      DO 34 I=1,NGRP

	ITMP(N)=IBUF(IGRP(I))

34      N=N+1

35      IF(ITF)37,37,36

36      ITMP(N)=KNT

37      IF(NF-2)38,40,38

38      DO 39 I=1,NNEW

	IBUFO(K)=ITMP(I)

39      K=K+1

	GO TO 49

C DIDN'T CHECK THIS 8/93

40      DO 41 I=1,NNEW,2

c        CALL PACK(ITMP(I)*16,ITMP(I+1)*16,IBUFO(K))

41      K=K+1

	GO TO 49

47      ICH=ICH+1

	IF(ICH-NCO)49,48,48

48      ICH=0

49      CALL PUTSTD(IBUFO)

50      RETURN

	END

