C GPAST.FIL- PROGRAM TO PASS GROUP VARS LIKE GPASS, BUT ALSO ALLOWING

C INSERTION OF COPIES OF UP TO 10 GROUP-VARS FROM THE PRECEDING

C RECORD-SET. THIS IS TO ALLOW ANALYSIS OF POSSIBLE CARRYOVER FROM

C PREVIOUS TRIAL (VIA MANOVA). FIRST RECORD-SET OF EACH RUN GETS

C VALUES OF 9 FOR ANY SUCH GROUP-VARS.

	SUBROUTINE GPAST

	COMMON IFLAG1,IFLAG2,IFLAG3,KNT

	COMMON/FLDES/ID(8),IBUF(256)

	COMMON/FLDESO/IDO(8),IBUFO(256)

	COMMON/DEV/ITI

	DIMENSION LABS(6,20)

	INTEGER*4, SAVE :: NSO,LR,LR1,NGR

	INTEGER*4, SAVE, DIMENSION(10) :: IGRP,NGRP

	EQUIVALENCE (ID(1),NG),(IDO(1),NGO),(LABS(1,1),IBUF(1))

	DATA ILP,IRP /'(',')'/

      INTEGER SELGRPS(20)
	CHARACTER*24 LINESEL(20)
      COMMON /SELGVS/ SELGRPS,LINESEL
      CHARACTER*24 STEMP
      INTEGER ICTEMP(6)
      EQUIVALENCE (ICTEMP,STEMP)

	IF(IFLAG1)1,20,35

1     IF(NG-1)35,35,10

10    CONTINUE
!10    WRITE(*,200)(I,(LABS(J,I),J=1,6),I=2,NG)
!
!200   FORMAT(' VAR ',I2,' ID=',6A4)
!
!	WRITE(*,201)(ILP,IRP,I=1,MIN(NG-1,10))
!
!201   FORMAT(' VARS TO CARRY OVER:'/1H ,10(A1,2XA1,:))
!
!C	READ(*,100)(IGRP(I),I=1,10)
!      CALL GETVALU(2,IVAL,ALINE,'(A)')
!      WRITE(*,'(A)')ALINE
!      READ(ALINE,100,end=113)(IGRP(I),I=1,10)
!113   CONTINUE   
!
!100   FORMAT(T1,1XI2,9(2XI2))
      READ(LINESEL(1),*,end=114)(IGRP(I),I=1,10)
114   CONTINUE   
      

C FIRST COPY LABELS OF EXISTING VARS, WHICH WILL BE PASSED TO OUTFIL

	N=6*NG

	J=121

	DO 5 I=13,N

	IBUFO(J)=IBUF(I)

5     J=J+1

	NGR=0

	DO 6 I=1,10

	IF(IGRP(I))6,6,7

7     NGR=NGR+1

6     NGRP(I)=9

	NGO=NG+NGR

	DO 8 I=1,NGR

	K2=6*IGRP(I)

	K1=K2-5

!	DO 8 K=K1,K2
!
!	IBUFO(J)=IBUF(K)
!
!8     J=J+1
      
      J0=1
      DO 81, K=K1,K2
      ICTEMP(J0)=IBUF(K)
81    J0=J0+1
      STEMP=TRIM(STEMP)//'*'
      IBUFO(J:J+5)=ICTEMP
8     J=J+6

!	WRITE(*,202)
!
!202   FORMAT('$RUN LENGTH(.LE. # RECSETS)? >'\)
!
!C	READ(*,101)LR
!      CALL GETVALU(2,IVAL,ALINE,'(A)')
!      WRITE(*,'(A)')ALINE
!      READ(ALINE,101)LR
!
!101   FORMAT(I4)
      READ(LINESEL(2),*)LR

	LR1=1

	NSO=NG+1

	RETURN

C EXECUTION PHASE

20    IF(NG-2)35,35,21

21    DO 25 I=3,NG

25    IBUFO(I)=IBUF(I)

	NSO1=NSO

	IGO=KNT-LR1+1

	IF(IGO)26,26,27

27    LR1=LR1+LR

26    DO 28 I=1,NGR

	IBUFO(NSO1)=NGRP(I)

	IF(IGO)271,272,271

271   NGRP(I)=IBUF(IGRP(I))

	GO TO 28

272   NGRP(I)=9

28    NSO1=NSO1+1

35    RETURN

	END

