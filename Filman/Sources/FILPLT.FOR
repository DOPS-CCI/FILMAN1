	USE IFQWIN

	INCLUDE 'MAX.INC'

	RECORD/RCCOORD/ S

      PARAMETER (MARGIN=20) 

      RECORD/xycoord/ XY 

      RECORD/qwinfo/ WINFO

      RECORD/windowconfig/ WC

	CHARACTER*1 IA

	INTEGER*2 IX,IY,ISTAT

	REAL*4 XR,XI

	LOGICAL*4 RES

	COMMON/FLDES/ NG,NA,NC,NP,NF,NL,NR,IS,IBUF(IOMAX)

	INTEGER*4 IBUF1(116)

	EQUIVALENCE (IBUF1(1),NG)

	CALL GETOPN

	CALL GETSTD(IBUF1) !Read first header record

	CALL GETSTD(IBUF) !Read second header record

	OPEN(UNIT=10,FILE='USER',TITLE='PLOT')

      WC%numxpixels=-1

      WC%numypixels=-1

      WC%numtextcols=-1

      WC%numtextrows=-1

      WC%fontsize=#00010001

      RES=SETWINDOWCONFIG(WC)

      RES=GETWINDOWCONFIG(WC)

      WRITE(*,1) WC%numxpixels,WC%numypixels

1     FORMAT(2I5)

	NR0=NR/NC

	

	DO 100 I=1,NR0

	DO 100 J=1,NC

	CALL GETSTD(IBUF)

!     Find maximum for this record	

	YMAX=PXVAL(1)

	YMIN=YMAX

	DO 101 K=2,NP

	XR=PXVAL(K)

	IF (XR.GT.YMAX) YMAX=XR

	IF (XR.LT.YMIN) YMIN=XR

101   CONTINUE

      

      WINFO%TYPE=QWIN$MAX

	IRESULT=SETWSIZEQQ(10,WINFO)

	IRESULT=GETWSIZEQQ(10,QWIN$SIZEMAX,WINFO)

	XDIM=REAL(WINFO%W*8-2*MARGIN)

	YDIM=REAL(WINFO%H*16-2*MARGIN)

	XSCALE=XDIM/(NP-1)

	CALL CLEARSCREEN($GCLEARSCREEN)

	IY = INT2(YDIM*((YMAX-PXVAL(1))/(YMAX-YMIN))+MARGIN+0.5)

	IX = INT2(MARGIN)

	CALL MOVETO(IX,IY,XY)

	DO 200 K=2,NP

	IY=INT2(YDIM*((YMAX-PXVAL(K))/(YMAX-YMIN))+MARGIN+0.5)

	IX=INT2(REAL(K-1)*XSCALE+MARGIN+0.5)

200	ISTAT = LINETO(IX,IY)

      READ(10,300)IA

300   FORMAT(A1)

      IF (IA.EQ.'q' .OR. IA.EQ.'Q') STOP

100   CONTINUE

	END



	REAL FUNCTION PXVAL(J)

      INCLUDE 'MAX.INC'

	COMMON/FLDES/ NG,NA,NC,ND,NF,NP,NR,IS,IBUF(IOMAX)

	DIMENSION IV(2)

	EQUIVALENCE (IV(1),IV1),(IV(2),IV2),(IX,X)

	K=NG+NA

	GO TO(10,20,30,40)NF    ! INT*4,INT*2,REAL*4,COMPLEX

10    PXVAL=REAL(IBUF(J+K))          ! NB: CONVERTS INT*4 TO REAL*4

      RETURN

20    L=(J+1)/2

	I=J-L-L+2

	CALL UNPACK(IBUF(K+L),IV1,IV2)   ! UNPACK IS IN STDIO.FOR

	PXVAL=REAL(IV(I))

	RETURN

30    IX=IBUF(J+K)            ! NB: AVOIDS TYPE CONVERSION

      PXVAL=X

	RETURN

40    J=K+J+J-1

	IX=IBUF(J)

	XR=X

	IX=IBUF(J+1)

	XI=X

	PXVAL=SQRT(XR*XR+XI*XI)

	RETURN

	END

