      SUBROUTINE SYSWHF(IBUFO2,LEN1,IBUFO,MAXAR,NG,NCO)
C WRITE SYSTAT HEADERS FOR FAD     
C      INCLUDE 'MULTAR.INC'
      COMMON /ADVSV/ IASUNIT,SYSOUTFIL,IERRAD
      CHARACTER*64 SYSOUTFIL
      CHARACTER*72 IBUFO2(6)
      CHARACTER*24 IBUFO(*)
      CHARACTER*24 GIBUF(NG)
	DIMENSION IA0(8)
	CHARACTER*1 ENDCOMREC(72+2)
	DATA ENDCOMREC /72,72*'$',72/
	CHARACTER*12 CVARN
      
C NUMBER OF VARIABLES IN ONE SYSTAT RECORD (= IN ONE FILMAN RECORDSET)
      NV=2+1+(NG-2)+NCO*(1+(MAXAR/2+1)*5)
      MTYPE=1  ! Rectangular data
C      NTYPE=1  ! Single precision
      NTYPE=2  ! Double precision
      WRITE(IASUNIT)CHAR(75)
      WRITE(IASUNIT)CHAR(6),INT2(30),INT2(0),INT2(0),CHAR(6)
      DO 1,I=1,6
    1 CALL WRLECHAR(IASUNIT,72,IBUFO2(I))
      IF(NG.GE.3)THEN
        CALL WRLECHAR(IASUNIT,72,'GROUPING VARIABLES')
        DO 5,I=3,NG
        CALL WRLECHAR(IASUNIT,72,IBUFO(I))
    5   CONTINUE
      ENDIF
      CALL WRLECHAR(IASUNIT,72,'CHANNELS LABELS')
      DO 2,I=1,NCO
    2 CALL WRLECHAR(IASUNIT,72,IBUFO(NG+I))
      WRITE(IASUNIT)ENDCOMREC
      WRITE(IASUNIT)CHAR(6),INT2(NV),INT2(MTYPE),INT2(NTYPE),CHAR(6)
      CALL WRLECHAR(IASUNIT,12,'  NCHANS    ')
      CALL WRLECHAR(IASUNIT,12,' SMPLFRQ    ')
C      CALL WRLECHAR(IASUNIT,12,'  NBANDS    ')
      CALL WRLECHAR(IASUNIT,12,'   ORDER    ')
      DO 51,I=3,NG
      WRITE(CVARN,102)I
   51 CALL WRLECHAR(IASUNIT,12,CVARN)   

      DO 34,I=1,NCO
 	WRITE(CVARN,104)'NFAD',I
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	DO 38,J=1,MAXAR/2+1
 	WRITE(CVARN,1062)'BE',I,J
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1064)'BETA',I,J
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1065)'OMEGA',I,J
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1063)'PHI',I,J
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1063)'B2B',I,J
      CALL WRLECHAR(IASUNIT,12,CVARN)
   38 CONTINUE
   34 CONTINUE
      
100   FORMAT('  ',A1,A1,A1,I3.3,'    ')
101   FORMAT(A1,A1,I3.3,I3.3,'    ')
102   FORMAT('  GRPV',I2.2,'    ')
103   FORMAT('   ',A1,A4,'    ')
104   FORMAT(' ',A4,I3.3,'    ')
105   FORMAT('  ',A1,A1,A1,A3,'    ')
1062  FORMAT(A2,I3.3,I2.2,'     ')
1063  FORMAT(A3,I3.3,I2.2,'    ')
1064  FORMAT(A4,I3.3,I2.2,'   ')
1065  FORMAT(A5,I3.3,I2.2,'  ')
      RETURN
      END

      SUBROUTINE ADVANCEDFADSAVE(WYN,LEN,MX2,IF1,MCHANS,NCO,NGO)
C WRITE SYSTAT DATA RECORD FOR FAD OUTPUT   
C      INCLUDE 'MULTAR.INC'
      REAL WYN(0:MX2,IF1,MCHANS)
      COMMON /ADVSV/ IASUNIT,SYSOUTFIL,IERRAD
	COMMON/FLDES/ NG,NA,NC,ND,NF,NL,NR,IS,IBUF(108)
      CHARACTER*64 SYSOUTFIL
      INTEGER*4 IGBUF(NG)
      PARAMETER (RMIS=-1.0E36)
      DOUBLE PRECISION DMIS
      DATA DMIS /-1.0D36/
      DOUBLE PRECISION B2B

      CALL PUSHBUFD(IASUNIT,DBLE(NCO))
      CALL PUSHBUFD(IASUNIT,DBLE(IS))
      CALL PUSHBUFD(IASUNIT,DBLE(WYN(0,4,1))) ! IORD
      DO 5,I=3,NGO
    5 CALL PUSHBUFD(IASUNIT,DBLE(IBUF(I)))

      DO 34,I=1,NCO
      CALL PUSHBUFD(IASUNIT,DBLE(LEN))
      DO 35,J=1,LEN
      CALL PUSHBUFD(IASUNIT,DBLE(WYN(J,1,I)))
      CALL PUSHBUFD(IASUNIT,DBLE(WYN(J,2,I)))
      CALL PUSHBUFD(IASUNIT,DBLE(WYN(J,4,I)))
      CALL PUSHBUFD(IASUNIT,DBLE(WYN(J,3,I)))
      B2B=WYN(J,1,I)**2/WYN(J,2,I)
      CALL PUSHBUFD(IASUNIT,DBLE(B2B))
   35 CONTINUE
      DO 36,J=LEN+1,MX2
      CALL PUSHBUFD(IASUNIT,DMIS)
      CALL PUSHBUFD(IASUNIT,DMIS)
      CALL PUSHBUFD(IASUNIT,DMIS)
      CALL PUSHBUFD(IASUNIT,DMIS)
      CALL PUSHBUFD(IASUNIT,DMIS)
   36 CONTINUE      
   34 CONTINUE
      CALL FLUSHBUFD(IASUNIT)
      END
      
      SUBROUTINE SYSWHP(IBUFO2,LEN1,IBUFO,NB,NG,NCO)
C WRITE SYSTAT HEADERS FOR PEAKM
C      INCLUDE 'MULTAR.INC'
      COMMON /ADVSV/ IASUNIT,SYSOUTFIL,IERRAD
      INTEGER SELGRPS(20)
	CHARACTER*24 LINESEL(20)
      COMMON /SELGVS/ SELGRPS,LINESEL
      CHARACTER*64 SYSOUTFIL
      CHARACTER*72 IBUFO2(6)
      CHARACTER*24 IBUFO(*)
	CHARACTER*1 ENDCOMREC(72+2)
	DATA ENDCOMREC /72,72*'$',72/
	CHARACTER*12 CVARN
	PARAMETER (MAXNPEAKS=1)
      
      NV=3+(NG-2)+2*NB+NCO*5
      MTYPE=1  ! Rectangular data
C      NTYPE=1  ! Single precision
      NTYPE=2  ! Double precision
      WRITE(IASUNIT)CHAR(75)
      WRITE(IASUNIT)CHAR(6),INT2(30),INT2(0),INT2(0),CHAR(6)
      DO 1,I=1,6
    1 CALL WRLECHAR(IASUNIT,72,IBUFO2(I))
      IF(NG.GE.3)THEN
        CALL WRLECHAR(IASUNIT,72,'GROUPING VARIABLES')
        DO 5,I=3,NG
        CALL WRLECHAR(IASUNIT,72,IBUFO(I))
    5   CONTINUE
      ENDIF
      CALL WRLECHAR(IASUNIT,72,'CHANNELS LABELS')
      DO 2,I=1,NCO
    2 CALL WRLECHAR(IASUNIT,72,IBUFO(NG+I))
      WRITE(IASUNIT)ENDCOMREC
      WRITE(IASUNIT)CHAR(6),INT2(NV),INT2(MTYPE),INT2(NTYPE),CHAR(6)
      CALL WRLECHAR(IASUNIT,12,'  NCHANS    ')
      CALL WRLECHAR(IASUNIT,12,' SMPLFRQ    ')
      CALL WRLECHAR(IASUNIT,12,'  NBANDS    ')
C      CALL WRLECHAR(IASUNIT,12,'   ORDER    ')
      DO 51,I=3,NG
      WRITE(CVARN,102)I
   51 CALL WRLECHAR(IASUNIT,12,CVARN)   

C NUMBER PEAKS IN THE BAND, PLUS (FOR THE SELECTED
C PEAK) PEAK FREQUENCY, PEAK AMPLITUDE, PEAK AREA AND THE PEAK'S HALF-AMPLITUDE WIDTH      
      DO 30,IB=1,NB
 	WRITE(CVARN,104)'FMIN',IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,104)'FMAX',IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
   30 CONTINUE
      DO 34,I=1,NCO
      DO 31,IB=1,NB
 	WRITE(CVARN,106)'NPKS',I,IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
      DO 35,IPK=1,MAXNPEAKS
 	WRITE(CVARN,1065)'PKFRQ',I,IB,IPK
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1065)'PKAMP',I,IB,IPK
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1065)'PKARE',I,IB,IPK
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1065)'PKHAW',I,IB,IPK
      CALL WRLECHAR(IASUNIT,12,CVARN)
   35 CONTINUE   
   31 CONTINUE
   34 CONTINUE
      
100   FORMAT('  ',A1,A1,A1,I3.3,'    ')
101   FORMAT(A1,A1,I3.3,I3.3,'    ')
102   FORMAT('  GRPV',I2.2,'    ')
103   FORMAT('   ',A1,A4,'    ')
104   FORMAT(' ',A4,I3.3,'    ')
105   FORMAT('  ',A1,A1,A1,A3,'    ')
106   FORMAT(A4,I3.3,I2.2,'   ')
1062  FORMAT(A2,I3.3,I2.2,'     ')
1063  FORMAT(A3,I3.3,I2.2,'    ')
1064  FORMAT(A4,I3.3,I2.2,I2.2,' ')
1065  FORMAT(A5,I3.3,I2.2,I2.2)
      RETURN
      END

      SUBROUTINE SYD1PEAKMSAVE(NB,NCO,NGO)
C WRITE SYSTAT DATA RECORD FOR PEAKM OUTPUT 
C      INCLUDE 'MULTAR.INC'
      COMMON /ADVSV/ IASUNIT,SYSOUTFIL,IERRAD
	COMMON/FLDES/ NG,NA,NC,ND,NF,NL,NR,IS,IBUF(108)
      INTEGER SELGRPS(20)
	CHARACTER*24 LINESEL(20)
      COMMON /SELGVS/ SELGRPS,LINESEL
      CHARACTER*64 SYSOUTFIL
      INTEGER*4 IGBUF(NG)
      PARAMETER (RMIS=-1.0E36)
      DOUBLE PRECISION DMIS
      DIMENSION PKMEAS(5)
      DATA DMIS /-1.0D36/

      CALL PUSHBUFD(IASUNIT,DBLE(NCO))
      CALL PUSHBUFD(IASUNIT,DBLE(IS))
      CALL PUSHBUFD(IASUNIT,DBLE(NB))
      DO 5,I=3,NGO
    5 CALL PUSHBUFD(IASUNIT,DBLE(IBUF(I)))

      DO 30,IB=1,NB
      CALL PUSHBUFD(IASUNIT,DBLE(SELGRPS(IB)))
      CALL PUSHBUFD(IASUNIT,DBLE(SELGRPS(IB+10)))
   30 CONTINUE
      END

      SUBROUTINE SYD2PEAKMSAVE(PKMEAS,NCO)
C WRITE SYSTAT DATA RECORD FOR PEAKM OUTPUT
C      INCLUDE 'MULTAR.INC'
      COMMON /ADVSV/ IASUNIT,SYSOUTFIL,IERRAD
      PARAMETER (RMIS=-1.0E36)
      DOUBLE PRECISION DMIS
      DIMENSION PKMEAS(5)
      DATA DMIS /-1.0D36/
	PARAMETER (MAXNPEAKS=1)

      CALL PUSHBUFD(IASUNIT,DBLE(PKMEAS(1)))
      DO 34,I=1,MIN(MAX(NINT(PKMEAS(1)),1),MAXNPEAKS)
      IF(PKMEAS(1).NE.0.)THEN
        CALL PUSHBUFD(IASUNIT,DBLE(PKMEAS(2)))
        CALL PUSHBUFD(IASUNIT,DBLE(PKMEAS(3)))
        CALL PUSHBUFD(IASUNIT,DBLE(PKMEAS(4)))
        CALL PUSHBUFD(IASUNIT,DBLE(PKMEAS(5)))
      ELSE
        CALL PUSHBUFD(IASUNIT,DMIS)
        CALL PUSHBUFD(IASUNIT,DMIS)
        CALL PUSHBUFD(IASUNIT,DMIS)
        CALL PUSHBUFD(IASUNIT,DMIS)
      ENDIF
   34 CONTINUE
      DO 35,I=MIN(MAX(NINT(PKMEAS(1)),1),MAXNPEAKS)+1,MAXNPEAKS
      CALL PUSHBUFD(IASUNIT,DMIS)
      CALL PUSHBUFD(IASUNIT,DMIS)
      CALL PUSHBUFD(IASUNIT,DMIS)
      CALL PUSHBUFD(IASUNIT,DMIS)
      CALL PUSHBUFD(IASUNIT,DMIS)
   35 CONTINUE
      END      
      
      SUBROUTINE ENDSYDREC
C WRITE SYSTAT DATA RECORD FOR FAD/PEAKM/BANDS OUTPUT   
C      INCLUDE 'MULTAR.INC'
      COMMON /ADVSV/ IASUNIT,SYSOUTFIL,IERRAD
      CALL FLUSHBUFD(IASUNIT)
      RETURN
      END
      
      SUBROUTINE SYSWHB(IBUFO2,LEN1,IBUFO,NB,NG,NCO)
C WRITE SYSTAT HEADERS FOR BANDS
      COMMON /ADVSV/ IASUNIT,SYSOUTFIL,IERRAD
      INTEGER SELGRPS(20)
	CHARACTER*24 LINESEL(20)
      COMMON /SELGVS/ SELGRPS,LINESEL
      CHARACTER*64 SYSOUTFIL
      CHARACTER*72 IBUFO2(6)
      CHARACTER*24 IBUFO(*)
	CHARACTER*1 ENDCOMREC(72+2)
	DATA ENDCOMREC /72,72*'$',72/
	CHARACTER*12 CVARN
	PARAMETER (MAXNPEAKS=1)
      
      NV=3+(NG-2)+2*NB+NCO*6*NB
      MTYPE=1  ! Rectangular data
      NTYPE=2  ! Double precision
      WRITE(IASUNIT)CHAR(75)
      WRITE(IASUNIT)CHAR(6),INT2(30),INT2(0),INT2(0),CHAR(6)
      DO 1,I=1,6
    1 CALL WRLECHAR(IASUNIT,72,IBUFO2(I))
      IF(NG.GE.3)THEN
        CALL WRLECHAR(IASUNIT,72,'GROUPING VARIABLES')
        DO 5,I=3,NG
        CALL WRLECHAR(IASUNIT,72,IBUFO(I))
    5   CONTINUE
      ENDIF
      CALL WRLECHAR(IASUNIT,72,'CHANNELS LABELS')
      DO 2,I=1,NCO
    2 CALL WRLECHAR(IASUNIT,72,IBUFO(NG+I))
      WRITE(IASUNIT)ENDCOMREC
      WRITE(IASUNIT)CHAR(6),INT2(NV),INT2(MTYPE),INT2(NTYPE),CHAR(6)
      CALL WRLECHAR(IASUNIT,12,'  NCHANS    ')
      CALL WRLECHAR(IASUNIT,12,' SMPLFRQ    ')
      CALL WRLECHAR(IASUNIT,12,'  NBANDS    ')
C      CALL WRLECHAR(IASUNIT,12,'   ORDER    ')
      DO 51,I=3,NG
      WRITE(CVARN,102)I
   51 CALL WRLECHAR(IASUNIT,12,CVARN)   
      
      DO 30,IB=1,NB
 	WRITE(CVARN,104)'FMIN',IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,104)'FMAX',IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
   30 CONTINUE
      DO 34,I=1,NCO
      DO 31,IB=1,NB
 	WRITE(CVARN,1065)'PKAMP',I,IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1065)'MNAMP',I,IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1065)'AMPSD',I,IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1064)'MEAN',I,IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1064)'STDV',I,IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
 	WRITE(CVARN,1064)'PLOC',I,IB
      CALL WRLECHAR(IASUNIT,12,CVARN)
   31 CONTINUE
   34 CONTINUE
      
100   FORMAT('  ',A1,A1,A1,I3.3,'    ')
101   FORMAT(A1,A1,I3.3,I3.3,'    ')
102   FORMAT('  GRPV',I2.2,'    ')
103   FORMAT('   ',A1,A4,'    ')
104   FORMAT(' ',A4,I3.3,'    ')
105   FORMAT('  ',A1,A1,A1,A3,'    ')
106   FORMAT(A4,I3.3,I2.2,'   ')
1062  FORMAT(A2,I3.3,I2.2,'     ')
1063  FORMAT(A3,I3.3,I2.2,'    ')
1064  FORMAT(' ',A4,I3.3,I2.2,'  ')
1065  FORMAT(A5,I3.3,I2.2,'  ')
      RETURN
      END

      SUBROUTINE SYD1BANDSSAVE(NB,NCO,NGO)
C WRITE SYSTAT DATA RECORD FOR BANDS OUTPUT
C      INCLUDE 'MULTAR.INC'
      COMMON /ADVSV/ IASUNIT,SYSOUTFIL,IERRAD
	COMMON/FLDES/ NG,NA,NC,ND,NF,NL,NR,IS,IBUF(108)
      INTEGER SELGRPS(20)
	CHARACTER*24 LINESEL(20)
      COMMON /SELGVS/ SELGRPS,LINESEL
      CHARACTER*64 SYSOUTFIL
      INTEGER*4 IGBUF(NG)
      PARAMETER (RMIS=-1.0E36)
      DOUBLE PRECISION DMIS
      DIMENSION PKMEAS(5)
      DATA DMIS /-1.0D36/

      CALL PUSHBUFD(IASUNIT,DBLE(NCO))
      CALL PUSHBUFD(IASUNIT,DBLE(IS))
      CALL PUSHBUFD(IASUNIT,DBLE(NB))
      DO 5,I=3,NGO
    5 CALL PUSHBUFD(IASUNIT,DBLE(IBUF(I)))

      DO 30,IB=1,NB
      CALL PUSHBUFD(IASUNIT,DBLE(SELGRPS(IB)))
      CALL PUSHBUFD(IASUNIT,DBLE(SELGRPS(IB+10)))
   30 CONTINUE
      END

      SUBROUTINE SYD2BANDSSAVE(Q,NCO)
C WRITE SYSTAT DATA RECORD FOR BANDS OUTPUT 
C      INCLUDE 'MULTAR.INC'
      COMMON /ADVSV/ IASUNIT,SYSOUTFIL,IERRAD
      PARAMETER (RMIS=-1.0E36)
      DOUBLE PRECISION DMIS
      DIMENSION Q(6)
      DATA DMIS /-1.0D36/

      CALL PUSHBUFD(IASUNIT,DBLE(Q(1)))
      CALL PUSHBUFD(IASUNIT,DBLE(Q(2)))
      CALL PUSHBUFD(IASUNIT,DBLE(Q(3)))
      CALL PUSHBUFD(IASUNIT,DBLE(Q(4)))
      CALL PUSHBUFD(IASUNIT,DBLE(Q(5)))
      CALL PUSHBUFD(IASUNIT,DBLE(Q(6)))
      END      
      
