C BLPRO.FOR- DIVIDES INPUT PTS INTO BLOCKS & OUTPUTS BLOCK AVERAGES

	SUBROUTINE BLPRO

      INCLUDE 'MAX.INC'

	COMMON/DEV/ITI

	COMMON IFLAG1,IFLAG2,IFLAG3,KNT,ISZ,ICHAN(ICHMAX)

	COMMON/FLDES/ NG,NA,NC,ND,NF,NL,NR,IS,IBUF(IOMAX)

	COMMON/FLDESO/ NGO,NAO,NCO,NDO,NFO,NLO,NRO,ISO,IBUFO(IOMAX)

	COMMON/PTLST/NLIST,LIST(1,1)

	INTEGER*4, SAVE :: NB,NP,NSO,IGO

	REAL*4, SAVE :: FNP

	EQUIVALENCE (IX,X)
      COMMON /CPN/ CURPROCNAME
      CHARACTER*10 CURPROCNAME

	IF(IFLAG1) 20,10,60

20    NFO=3
      CURPROCNAME='BLPRO'

C MOVE CHANNEL LABELS

	J=6*NGO+109

	DO 12 I=1,NCO

	L=J+5

	K=6*(NG+ICHAN(I))-5

	DO 50 I1=J,L

	IBUFO(I1)=IBUF(K)

50    K=K+1

12    J=J+6

15    CALL DoBLPRODialog(INB,INP,IIGO,NDO)
!      WRITE(*,104)NDO
!
!104   FORMAT(' NUMBER OF INPUT POINTS SELECTED=',I5/
!
!     1  ' ENTER # BLOCKS, # PTS./BLOCK >'\)
!
!	READ(*,*) NB,NP
      NB=INB
      NP=INP

	IF(NB*NP-NDO)16,16,151

151   CONTINUE
!      WRITE(*,*)' TOO MANY POINTS REQUESTED; RE-SPECIFY BLOCKING'
      CALL ShowInfoText('Error',
     + ' TOO MANY POINTS REQUESTED; RE-SPECIFY BLOCKING')
      
	GO TO 15

16    CONTINUE
!      WRITE(*,100)
!
!100   FORMAT(' DATA TYPE: 1=TIME/2=SPECTRUM/3=OTHER >'\)
!
!	READ(*,*)IGO
      IGO=IIGO

	GO TO(21,22,21)IGO

21    ISO=ISO/NP

	ISZ=2*NB

	NDO=NB

	GO TO 23

22    IF(LIST(1,1).EQ.1)GO TO 221

C	WRITE(*,*)' ERROR: FOR SPECTRA, POINTS MUST START AT DC'
      CALL ShowInfoText('Error',
     + ' ERROR: FOR SPECTRA, POINTS MUST START AT DC')
 
	KNT=-1

	RETURN

221   ISZ=2*NB+2

	NDO=NB+1

	IF(NB*NP.EQ.ND-1)GO TO 23

	DF=FLOAT(IS)/(ND-1)

	ISO=NB*NP*DF      !NEW CUTOFF FREQUENCY

23    FNP=NP

	NSO=NGO+NAO+1

25    RETURN

10    K=1

	L=NSO

	GO TO (32,31,32)IGO

C FOR SPECTRA, FIRST COPY DC POINT

31    CALL XVAL(1,X,XI)

	IBUFO(L)=IX

	K=2

	L=L+1

32    DO 30 I=1,NB

	X=0.

	DO 40 J=1,NP

	CALL XVAL(K,XV,XI)

	X=X+XV

40    K=K+1

	X=X/FNP

	IBUFO(L)=IX

30    L=L+1

	CALL PUTSTD(IBUFO)

60    RETURN

	END

